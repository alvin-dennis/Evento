#!/bin/sh

echo "ğŸš€ Running pre-push checks..."

if [ -d "client" ]; then
  echo "ğŸ“‚ Checking client..."
  cd client || exit 1

  echo "ğŸ“ Running TypeScript type check..."
  bun run typecheck
  if [ $? -ne 0 ]; then
    echo "âŒ Client TypeScript type check failed. Please fix type errors before pushing."
    exit 1
  fi

  echo "ğŸ” Running client lint check..."
  bunx biome check .
  if [ $? -ne 0 ]; then
    echo "âŒ Client lint check failed. Please fix lint errors before pushing."
    exit 1
  fi

  cd ..
else
  echo "âš ï¸ Client folder not found, skipping client checks."
fi

if [ -d "server" ]; then
  echo "ğŸ“‚ Checking server..."
  cd server || exit 1

  echo "ğŸ”¹ Running Ruff lint check..."
  ruff check .
  if [ $? -ne 0 ]; then
    echo "âŒ Server Ruff lint check failed. Please fix lint errors before pushing."
    exit 1
  fi

  cd ..
else
  echo "âš ï¸ Server folder not found, skipping server checks."
fi

echo "âœ… Pre-push checks passed!"
